{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowSelfManagedServices",
      "Effect": "Allow",
      "Action": [
        "apigateway:*",
        "cloudfront:*",
        "cloudfront-keyvaluestore:*",
        "cloudformation:*",
        "cloudwatch:*",
        "databrew:*",
        "dms:*",
        "docdb-elastic:*",
        "dynamodb:*",
        "ebs:*",
        "ecr:*",
        "eks:AccessKubernetesApi",
        "eks:List*",
        "eks:Describe*",
        "eks:CreateAddon",
        "eks:UpdateAddon",
        "eks:DescribeAddon",
        "eks:ListAddons",
        "eks:DescribeAddonVersions",         
        "elasticache:*",
        "elasticloadbalancing:*",
        "emr-containers:*",
        "emr-serverless:*",
        "events:*",
        "pipes:*",
        "firehose:*",
        "glue:*",
        "grafana:*",
        "kafka:*",
        "kafkaconnect:*",
        "kinesis:*",
        "kms:*",
        "lakeformation:*",
        "lambda:*",
        "logs:*",
        "mediaimport:*",
        "opsworks:*",
        "rds:*",
        "redshift:*",
        "route53:*",
        "s3:*",
        "s3tables:*",
        "secretsmanager:*",
        "sqs:*",
        "ssm:*",
        "sns:*",
        "sts:GetServiceBearerToken",
        "inspector2:BatchGet*",
        "athena:*",
        "datazone:*",
        "states:*",
        "geo:*"
      ],
      "Resource": "*"
    },
    {
      "Sid": "AllowGeoMapsAccess",
      "Effect": "Allow",
      "Action": [
        "geo-places:*",
        "geo-maps:*",
        "geo:*"
      ],
      "Resource": "*"
    },
    {
      "Sid": "AllowSandboxDevAthenaAccess",
      "Effect": "Allow",
      "Action": [
        "athena:*"
      ],
      "Resource": "*"
    },
    {
      "Sid": "AllowEC2Tagging",
      "Effect": "Allow",
      "Action": [
        "ec2:CreateTags",
        "ec2:DeleteTags"
      ],
      "Resource": "*"
    },
    {
      "Sid": "DenyKMSDecryptUnlessOnBehalfOfAWS",
      "Effect": "Deny",
      "Action": [
        "kms:Decrypt",
        "kms:ReEncrypt*"
      ],
      "Resource": "*",
      "Condition": {
        "Null": {
          "kms:ViaService": true
        }
      }
    },
    {
      "Sid": "DenyPublicIPInstanceCreation",
      "Effect": "Deny",
      "Action": [
        "ec2:RunInstances"
      ],
      "Resource": "*",
      "Condition": {
        "Bool": {
          "ec2:AssociatePublicIpAddress": "true"
        }
      }
    },
    {
      "Sid": "DenyPublicIPModification",
      "Effect": "Deny",
      "Action": [
        "ec2:ModifyInstanceAttribute",
        "ec2:AssociateAddress"
      ],
      "Resource": "arn:aws:ec2:*:*:instance/*",
      "Condition": {
        "BoolIfExists": {
          "ec2:AssociatePublicIpAddress": "true"
        }
      }
    },
    {
      "Sid": "DenyEIPAllocation",
      "Effect": "Deny",
      "Action": [
        "ec2:AllocateAddress"
      ],
      "Resource": "arn:aws:ec2:*:*:instance/*",
      "Condition": {
        "StringEquals": {
          "ec2:Domain": "vpc"
        }
      }
    },
    {
      "Sid": "DenyPublicIPNetworkInterface",
      "Effect": "Deny",
      "Action": [
        "ec2:AttachNetworkInterface"
      ],
      "Resource": "arn:aws:ec2:*:*:network-interface/*",
      "Condition": {
        "BoolIfExists": {
          "ec2:AssociatePublicIpAddress": "true"
        }
      }
    },
    {
      "Sid": "LimitedEC2Networking",
      "Effect": "Allow",
      "Action": [
        "ec2:AuthorizeSecurityGroup*",
        "ec2:CreateSecurityGroup",
        "ec2:DeleteSecurityGroup",
        "ec2:ModifySecurityGroupRules",
        "ec2:RevokeSecurityGroup*",
        "ec2:UpdateSecurityGroupRuleDescriptions*",
        "ec2:RunInstances",
        "ec2:CreateNetworkInterface"
      ],
      "Resource": [
        "arn:aws:ec2:*:*:security-group*",
        "arn:aws:ec2:*:*:security-group-rule*",
        "arn:aws:ec2:*:*:vpc*"
      ]
    },
    {
      "Sid": "LimitedEc2",
      "Effect": "Allow",
      "Action": "ec2:*",
      "Resource": [
        "arn:aws:ec2:*:*:declarative-policies-report*",
        "arn:aws:ec2:*:*:elastic-gpu*",
        "arn:aws:ec2:*:*:elastic-inference*",
        "arn:aws:ec2:*:*:export-image-task*",
        "arn:aws:ec2:*:*:export-instance-task*",
        "arn:aws:ec2:*:*:fleet*",
        "arn:aws:ec2:*:*:group*",
        "arn:aws:ec2:*:*:image*",
        "arn:aws:ec2:*:*:import-image-task*",
        "arn:aws:ec2:*:*:import-snapshot-task*",
        "arn:aws:ec2:*:*:instance*",
        "arn:aws:ec2:*:*:instance-event-window*",
        "arn:aws:ec2:*:*:key-pair*",
        "arn:aws:ec2:*:*:launch-template*",
        "arn:aws:ec2:*:*:license-configuration*",
        "arn:aws:ec2:*:*:network-interface*",
        "arn:aws:ec2:*:*:placement-group*",
        "arn:aws:ec2:*:*:replace-root-volume-task*",
        "arn:aws:ec2:*:*:reserved-instances*",
        "arn:aws:ec2:*:*:role*",
        "arn:aws:ec2:*:*:snapshot*",
        "arn:aws:ec2:*:*:spot-fleet-request*",
        "arn:aws:ec2:*:*:spot-instances-request*",
        "arn:aws:ec2:*:*:volume*"
      ]
    },
    {
      "Sid": "LimitedEc2Subnet",
      "Effect": "Allow",
      "Action": [
        "ec2:ImportInstance",
        "ec2:ModifyFleet",
        "ec2:ModifySpotFleetRequest",
        "ec2:RequestSpotFleet",
        "ec2:RequestSpotInstances",
        "ec2:RunInstances",
        "ec2:CreateNetworkInterface"
      ],
      "Resource": "arn:aws:ec2:*:*:subnet*"
    },
    {
      "Sid": "AllowAuditManagerAccess",
      "Effect": "Allow",
      "Action": [
        "auditmanager:CreateAssessment",
        "auditmanager:GetAccountStatus",
        "auditmanager:ListAssessmentFrameworks",
        "auditmanager:GetAssessmentFramework"
      ],
      "Resource": "*"
    },
    {
      "Sid": "AllowWAFv2",
      "Effect": "Allow",
      "Action": [
        "wafv2:*"
      ],
      "Resource": "*"
    },
    {
      "Sid": "DenyForbiddenIAMModifications",
      "Effect": "Deny",
      "Action": [
        "iam:AddClientIDToOpenIDConnectProvider",
        "iam:AddUserToGroup",
        "iam:AttachGroupPolicy",
        "iam:AttachUserPolicy",
        "iam:ChangePassword",
        "iam:CreateAccessKey",
        "iam:CreateAccessKey",
        "iam:CreateAccountAlias",
        "iam:CreateGroup",
        "iam:CreateOpenIDConnectProvider",
        "iam:CreateSAMLProvider",
        "iam:CreateUser",
        "iam:CreateVirtualMFADevice",
        "iam:DeactivateMFADevice",
        "iam:DeleteAccessKey",
        "iam:DeleteAccountAlias",
        "iam:DeleteAccountPasswordPolicy",
        "iam:DeleteGroup",
        "iam:DeleteGroupPolicy",
        "iam:DeleteOpenIDConnectProvider",
        "iam:DeleteRolePermissionsBoundary",
        "iam:DeleteSAMLProvider",
        "iam:DeleteUser",
        "iam:DeleteUserPolicy",
        "iam:DeleteVirtualMFADevice",
        "iam:DetachUserPolicy",
        "iam:DisableOrganizationsRootCredentialsManagement",
        "iam:DisableOrganizationsRootSessions",
        "iam:EnableMFADevice",
        "iam:EnableOrganizationsRootCredentialsManagement",
        "iam:EnableOrganizationsRootSessions",
        "iam:PutGroupPolicy",
        "iam:PutRolePermissionsBoundary",
        "iam:PutUserPolicy",
        "iam:RemoveClientIDFromOpenIDConnectProvider",
        "iam:RemoveUserFromGroup",
        "iam:ResyncMFADevice",
        "iam:SetSecurityTokenServicePreferences",
        "iam:SetSTSRegionalEndpointStatus",
        "iam:TagMFADevice",
        "iam:TagOpenIDConnectProvider",
        "iam:TagSAMLProvider",
        "iam:TagUser",
        "iam:UntagMFADevice",
        "iam:UntagOpenIDConnectProvider",
        "iam:UntagSAMLProvider",
        "iam:UntagUser",
        "iam:UpdateAccountEmailAddress",
        "iam:UpdateAccountName",
        "iam:UpdateAccountPasswordPolicy",
        "iam:UpdateGroup",
        "iam:UpdateOpenIDConnectProviderThumbprint",
        "iam:UpdateSAMLProvider",
        "iam:UpdateUser",
        "iam:UploadSigningCertificate"
      ],
       "Resource": [
          "*"
        ]
    },
    {
      "Sid": "PermitIAMRoleModificationsWithPermissionsBoundary",
      "Effect": "Allow",
      "Action": [
        "iam:CreateRole",
        "iam:AttachRolePolicy",
        "iam:DeleteRolePolicy",
        "iam:DetachRolePolicy",
        "iam:PutRolePolicy",
        "iam:TagRole",
        "iam:UntagRole",
        "iam:UpdateAssumeRolePolicy",
        "iam:UpdateRole"
      ],
      "Resource": [
        "arn:aws:iam::*:role/sandbox/*",
        "arn:aws:iam::*:role/sandbox-*",
        "arn:aws:iam::*:role/aws-service-role/*/sandbox*"
      ],
      "Condition": {
        "ArnLike": {
          "iam:PermissionsBoundary": "arn:aws:iam::*:policy/platform/SandboxPermissionsBoundary"
        }
      }
    },
    {
      "Sid": "PermitIAMRoleDeletionForSandboxRoles",
      "Effect": "Allow",
      "Action": ["iam:DeleteRole"],
      "Resource": [
        "arn:aws:iam::*:role/sandbox/*",
        "arn:aws:iam::*:role/sandbox-*",
        "arn:aws:iam::*:role/aws-service-role/*/sandbox*"
      ]
    },
    {
      "Sid": "PermitIAMPolicyModificationsInSandboxPrefixes",
      "Effect": "Allow",
      "Action": [
        "iam:CreatePolicyVersion",
        "iam:CreatePolicy",
        "iam:DeletePolicyVersion",
        "iam:TagPolicy",
        "iam:UntagPolicy",
        "iam:DeletePolicy"
      ],
      "Resource": [
        "arn:aws:iam::*:policy/sandbox/*",
        "arn:aws:iam::*:policy/sandbox-*"
      ]
    },
    {
      "Sid": "PermitInstanceProfileModifications",
      "Effect": "Allow",
      "Action": "iam:*",
      "Resource": "arn:aws:iam::*:instance-profile/*"
    },
    {
      "Sid": "PermitIAMReadBroadly",
      "Effect": "Allow",
      "Action": [
        "iam:List*",
        "iam:Get*",
        "iam:Describe*",
        "iam:Generate*"
      ],
      "Resource": [
        "*"
      ]
    },
    {
      "Sid": "DenyViewAccessToSensitiveEntities",
      "Effect": "Deny",
      "Action": [
        "iam:Get*",
        "iam:Describe*"
      ],
      "Resource": [
        "arn:aws:iam::*:policy/platform/SandboxPermissionsBoundary",
        "arn:aws:iam::*:role/platform/terragrunter",
        "arn:aws:iam::*:role/terragrunter",
        "arn:aws:iam::*:role/aws-controltower-*",
        "arn:aws:iam::*:role/aws-reserved/sso.amazonaws.com/*"
      ]
    },
    {
      "Sid": "PermitRoleTransfer",
      "Effect": "Allow",
      "Action": ["iam:PassRole"],
      "Resource": [
        "arn:aws:iam::*:role/sandbox/*",
        "arn:aws:iam::*:role/sandbox-*",
        "arn:aws:iam::*:role/aws-service-role/*/sandbox*"
      ]
    },
    {
      "Sid": "DenyAllIAMModificationsToNonSandbox",
      "Effect": "Deny",
      "Action": [
        "sts:AssumeRole",
        "iam:Activate*",
        "iam:Add*",
        "iam:Attach*",
        "iam:Create*",
        "iam:Deactivate*",
        "iam:Delete*",
        "iam:Detach*",
        "iam:Disable*",
        "iam:Put*",
        "iam:Remove*",
        "iam:Reset*",
        "iam:Set*",
        "iam:Tag*",
        "iam:Untag*",
        "iam:Update*",
        "iam:Upload*"
      ],
      "NotResource": [
        "arn:aws:iam::*:role/sandbox/*",
        "arn:aws:iam::*:policy/sandbox/*",
        "arn:aws:iam::*:role/sandbox-*",
        "arn:aws:iam::*:policy/sandbox-*",
        "arn:aws:iam::*:role/aws-service-role/*/sandbox*"
      ]
    }
  ]
}